(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),e.addEventListener("click",r)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),e.removeEventListener("click",r)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e){e.target===e.currentTarget&&t(e.currentTarget)}const n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"b8f67a7d-e964-4184-b09c-85090c5cec14","Content-Type":"application/json"}},c=e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`),a=e=>fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:n.headers}).then((e=>c(e))),s=e=>fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e))),l=e=>fetch(`${n.baseUrl}/cards/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e)));function u(e,t,o,r,n,c){const a=t.querySelector(".card").cloneNode(!0),s=e._id,l=a.querySelector(".card__image"),u=a.querySelector(".card__title"),i=a.querySelector(".card__delete-button"),p=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return l.src=e.link,l.alt=e.name,u.textContent=e.name,d.textContent=e.likes.length,e.likes.some((e=>e._id===c))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(()=>{r(p,s,d)})),i.addEventListener("click",(()=>{o(i,s)})),l.addEventListener("click",n),e.owner._id!==c&&i.remove(),a}function i(e,t){l(t).then((()=>{e.closest(".card").remove()})).catch((e=>{console.log(e)}))}function p(e,t,o){e.classList.contains("card__like-button_is-active")?s(t).then((t=>{e.classList.remove("card__like-button_is-active"),o.textContent=t.likes.length})).catch((e=>{console.log(e)})):a(t).then((t=>{e.classList.add("card__like-button_is-active"),o.textContent=t.likes.length})).catch((e=>{console.log(e)}))}function d(e,t,o){e.classList.remove(o.inputErrorClass),t.textContent=e.validationMessage,t.classList.remove(o.errorClass)}function _(e,t,o){t?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))}const y=(e,t)=>{const o=e.querySelectorAll(t.inputSelector);_(e.querySelector(t.submitButtonSelector),e.checkValidity(),t),[...o].forEach((e=>{e.setCustomValidity(""),d(e,e.nextElementSibling,t)}))},m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},h=document.querySelector("#card-template").content,v=document.querySelector(".places__list"),S=document.querySelector(".profile__image"),f=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),q=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__edit-button"),E=q.querySelector(".popup__close"),g=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_new-card"),C=L.querySelector(".popup__close"),x=document.querySelector(".popup_type_image"),$=x.querySelector(".popup__close"),U=document.querySelector(".popup_type_avatar"),T=U.querySelector(".popup__close"),B=q.querySelector(".popup__form"),P=B.querySelector(".popup__input_type_name"),V=B.querySelector(".popup__input_type_description"),w=L.querySelector(".popup__form"),A=U.querySelector(".popup__form"),D=(e,t)=>{t.textContent=e?"Сохранение...":"Сохранить"};function M(t){x.querySelector(".popup__image").src=t.target.src,x.querySelector(".popup__image").alt=t.target.alt,x.querySelector(".popup__caption").textContent=t.target.alt,e(x)}let N;var O;k.addEventListener("click",(t=>{P.value=f.textContent,V.value=b.textContent,y(B,m),e(q)})),g.addEventListener("click",(t=>{e(L),w.reset(),y(w,m)})),S.addEventListener("click",(t=>{e(U),A.reset(),y(A,m)})),E.addEventListener("click",(e=>{t(q)})),C.addEventListener("click",(e=>{t(L)})),$.addEventListener("click",(e=>{t(x)})),T.addEventListener("click",(e=>{t(U)})),B.addEventListener("submit",(function(e){e.preventDefault();const o=P.value,r=V.value;var a,s;D(!0,q.querySelector(".popup__button")),(a=o,s=r,fetch(`${n.baseUrl}/users/me`,{method:"PATCH",headers:n.headers,body:JSON.stringify({name:a,about:s})}).then((e=>c(e)))).then((e=>{f.textContent=e.name,b.textContent=e.about,t(q)})).catch((e=>{console.log(e)})).finally((()=>{D(!1,q.querySelector(".popup__button"))}))})),w.addEventListener("submit",(function(e){e.preventDefault();const o=L.querySelector(".popup__input_type_card-name"),r=L.querySelector(".popup__input_type_url");var a,s;D(!0,L.querySelector(".popup__button")),(a=o.value,s=r.value,fetch(`${n.baseUrl}/cards`,{method:"POST",headers:n.headers,body:JSON.stringify({name:a,link:s})}).then((e=>c(e)))).then((e=>{const o=u(e,h,i,p,M,N);v.prepend(o),t(L)})).catch((e=>{console.log(e)})).finally((()=>{D(!1,L.querySelector(".popup__button"))}))})),A.addEventListener("submit",(function(e){e.preventDefault();const o=document.querySelector(".avatar__input_type_url").value;var r;S.src=o,D(!0,U.querySelector(".popup__button")),(r=o,fetch(`${n.baseUrl}/users/me/avatar`,{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:r})}).then((e=>c(e)))).then((e=>{S.style.backgroundImage=`url(${e.avatar})`,t(U)})).catch((e=>{console.log(e)})).finally((()=>{D(!1,U.querySelector(".popup__button"))}))})),Promise.all([fetch(`${n.baseUrl}/cards`,{headers:n.headers}).then((e=>c(e))),fetch(`${n.baseUrl}/users/me`,{headers:n.headers}).then((e=>c(e)))]).then((([e,t])=>{f.textContent=t.name,b.textContent=t.about,S.style.backgroundImage=`url(${t.avatar})`,N=t._id,function(e,t){e.forEach((e=>{!function(e,t,o,r,n,c){const a=u(e,t,o,r,n,c);v.append(a)}(e,h,i,p,M,t)}))}(e,N)})).catch((e=>{console.log(e)})),O=m,[...document.querySelectorAll(O.formSelector)].forEach((function(e){!function(e,t){const o=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);_(r,e.checkValidity(),t),[...o].forEach((function(o){o.addEventListener("input",(function(){_(r,e.checkValidity(),t),function(e,t,o){const r=e.validity.valid,n=t.querySelector(`#${e.name}-error`);e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),r?d(e,n,o):function(e,t,o){e.classList.add(o.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(o.errorClass)}(e,n,o)}(o,e,t)}))}))}(e,O)}))})();