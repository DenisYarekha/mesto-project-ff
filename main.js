(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),e.addEventListener("click",r)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),e.removeEventListener("click",r)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e){e.target===e.currentTarget&&t(e.currentTarget)}const n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"b8f67a7d-e964-4184-b09c-85090c5cec14","Content-Type":"application/json"}},c=e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`),a=()=>fetch(`${n.baseUrl}/users/me`,{headers:n.headers}).then((e=>c(e))),s=()=>fetch(`${n.baseUrl}/cards`,{headers:n.headers}).then((e=>c(e))),l=e=>fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:n.headers}).then((e=>c(e))),u=e=>fetch(`${n.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e))),i=e=>fetch(`${n.baseUrl}/cards/${e}`,{method:"DELETE",headers:n.headers}).then((e=>c(e)));function p(e,t,o,r,n,c){const a=t.querySelector(".card").cloneNode(!0),s=e._id,l=a.querySelector(".card__image"),u=a.querySelector(".card__title"),i=a.querySelector(".card__delete-button"),p=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-counter");return l.src=e.link,l.alt=e.name,u.textContent=e.name,d.textContent=e.likes.length,e.likes.some((e=>e._id===c))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(()=>{r(p,s,d)})),i.addEventListener("click",(()=>{o(i,s)})),l.addEventListener("click",n),e.owner._id!==c&&i.remove(),a}function d(e,t){i(t).then((()=>{e.closest(".card").remove()})).catch((e=>{console.log(e)}))}function _(e,t,o){e.classList.contains("card__like-button_is-active")?u(t).then((t=>{e.classList.remove("card__like-button_is-active"),o.textContent=t.likes.length})).catch((e=>{console.log(e)})):l(t).then((t=>{e.classList.add("card__like-button_is-active"),o.textContent=t.likes.length})).catch((e=>{console.log(e)}))}const y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function m(e,t,o){e.classList.remove(o.inputErrorClass),t.textContent=e.validationMessage,t.classList.remove(o.errorClass)}function h(e,t,o){t?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))}const v=(e,t)=>{[...e.querySelectorAll(t.inputSelector)].forEach((e=>{e.setCustomValidity(""),m(e,e.nextElementSibling,y)}))},f=document.querySelector("#card-template").content,S=document.querySelector(".places__list"),b=document.querySelector(".profile__image"),q=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),E=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__edit-button"),L=E.querySelector(".popup__close"),C=document.querySelector(".profile__add-button"),x=document.querySelector(".popup_type_new-card"),$=x.querySelector(".popup__close"),U=document.querySelector(".popup_type_image"),T=U.querySelector(".popup__close"),P=document.querySelector(".popup_type_avatar"),w=P.querySelector(".popup__close"),A=E.querySelector(".popup__form"),B=A.querySelector(".popup__input_type_name"),D=A.querySelector(".popup__input_type_description"),V=x.querySelector(".popup__form"),M=P.querySelector(".popup__form"),N=(e,t)=>{t.textContent=e?"Сохранение...":"Сохранить"};function O(t){U.querySelector(".popup__image").src=t.target.src,U.querySelector(".popup__image").alt=t.target.alt,U.querySelector(".popup__caption").textContent=t.target.alt,e(U)}let j;var J;g.addEventListener("click",(t=>{B.value=q.textContent,D.value=k.textContent,v(A,y),e(E)})),C.addEventListener("click",(t=>{e(x),V.reset(),v(V,y)})),b.addEventListener("click",(t=>{e(P),M.reset(),v(M,y)})),L.addEventListener("click",(e=>{t(E)})),$.addEventListener("click",(e=>{t(x)})),T.addEventListener("click",(e=>{t(U)})),w.addEventListener("click",(e=>{t(P)})),A.addEventListener("submit",(function(e){e.preventDefault();const o=B.value,r=D.value;var a,s;N(!0,E.querySelector(".popup__button")),(a=o,s=r,fetch(`${n.baseUrl}/users/me`,{method:"PATCH",headers:n.headers,body:JSON.stringify({name:a,about:s})}).then((e=>c(e)))).then((e=>{q.textContent=e.name,k.textContent=e.about,t(E)})).catch((e=>{console.log(e)})).finally((()=>{N(!1,E.querySelector(".popup__button")),A.reset(),t(E)}))})),V.addEventListener("submit",(function(e){e.preventDefault();const o=x.querySelector(".popup__input_type_card-name"),r=x.querySelector(".popup__input_type_url");var a,s;N(!0,x.querySelector(".popup__button")),(a=o.value,s=r.value,fetch(`${n.baseUrl}/cards`,{method:"POST",headers:n.headers,body:JSON.stringify({name:a,link:s})}).then((e=>c(e)))).then((e=>{const o=p(card,f,d,_,O);S.prepend(o),t(x)})).catch((e=>{console.log(e)})).finally((()=>{N(!1,x.querySelector(".popup__button")),V.reset(),t(x)}))})),M.addEventListener("submit",(function(e){e.preventDefault();const o=document.querySelector(".avatar__input_type_url").value;var r;b.src=o,N(!0,P.querySelector(".popup__button")),(r=o,fetch(`${n.baseUrl}/users/me/avatar`,{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:r})}).then((e=>c(e)))).then((e=>{b.style.backgroundImage=`url(${e.avatar})`,t(P)})).catch((e=>{console.log(e)})).finally((()=>{N(!1,P.querySelector(".popup__button")),M.reset(),t(P)}))})),Promise.all([s(),a()]),Promise.all([s(),a()]).then((([e,t])=>{q.textContent=t.name,k.textContent=t.about,b.style.backgroundImage=`url(${t.avatar})`,j=t._id,function(e,t){e.forEach((e=>{!function(e,t,o,r,n,c){const a=p(e,t,o,r,n,c);S.append(a)}(e,f,d,_,O,t)}))}(e,j)})).catch((e=>{console.log(e)})),J=y,[...document.querySelectorAll(J.formSelector)].forEach((function(e){!function(e,t){const o=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);h(r,e.checkValidity(),y),[...o].forEach((function(t){t.addEventListener("input",(function(){h(r,e.checkValidity(),y),function(e,t,o){const r=e.validity.valid,n=t.querySelector(`#${e.name}-error`);e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),r?m(e,n,y):function(e,t,o){e.classList.add(o.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(o.errorClass)}(e,n,y)}(t,e)}))}))}(e,y)}))})();